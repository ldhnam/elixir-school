<!DOCTYPE html>

<html lang="en-us">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link href="http://gmpg.org/xfn/11" rel="profile">

  <meta name="description" content="Übungen zur Programmiersprache Elixir">
  <meta name="author" content="Sean Callan">

  <meta property="og:url" content="https://elixirschool.com/de/lessons/basics/testing/">
  <meta property="og:site_name" content="ElixirSchool">
  <meta property="og:title" content="
  Testen &middot; Elixir School

">
  <meta property="og:description" content="Übungen zur Programmiersprache Elixir">
  <meta property="og:image" content="https://elixirschool.com/assets/fb_share.jpg">

  <title>
    
  Testen &middot; Elixir School


  </title>

  <!-- CSS -->
  <link type="text/css" rel="stylesheet" href="/assets/app.css">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
  analytics.load("C0p07Sw9j7mZnycKDCgPOAyqJR5hhyoQ");
  analytics.page()
  }}();
  </script>

</head>


  
  <body class="theme-custom-purple ">
    <a id="github_ribbon" href="https://github.com/doomspork/elixir_school"><img src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>

    
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Elixir School
        </a>
      </h1>
      <p class="lead">Übungen zur Programmiersprache Elixir</p>
    </div>

    <nav class="sidebar-nav">
      
      
        
        
        
        
          <div class="sidebar-nav-group basics">
            <div class="sidebar-nav-header">
              <i class="fa  fa-chevron-down "></i>
              <span>Grundlagen</span>
            </div>
            <div class="sidebar-nav-list" >
              
                <div class="sidebar-nav-item">
                  1. <a class="sidebar-lesson " href="/de/lessons/basics/basics/">Grundlagen</a>
                </div>
              
                <div class="sidebar-nav-item">
                  2. <a class="sidebar-lesson " href="/de/lessons/basics/collections/">Collections</a>
                </div>
              
                <div class="sidebar-nav-item">
                  3. <a class="sidebar-lesson " href="/de/lessons/basics/enum/">Enums</a>
                </div>
              
                <div class="sidebar-nav-item">
                  4. <a class="sidebar-lesson " href="/de/lessons/basics/pattern-matching/">Pattern Matching</a>
                </div>
              
                <div class="sidebar-nav-item">
                  5. <a class="sidebar-lesson " href="/de/lessons/basics/control-structures/">Kontrollstrukturen</a>
                </div>
              
                <div class="sidebar-nav-item">
                  6. <a class="sidebar-lesson " href="/de/lessons/basics/functions/">Funktionen</a>
                </div>
              
                <div class="sidebar-nav-item">
                  7. <a class="sidebar-lesson " href="/de/lessons/basics/pipe-operator/">Pipe Operator</a>
                </div>
              
                <div class="sidebar-nav-item">
                  8. <a class="sidebar-lesson " href="/de/lessons/basics/modules/">Module</a>
                </div>
              
                <div class="sidebar-nav-item">
                  9. <a class="sidebar-lesson " href="/de/lessons/basics/mix/">Mix</a>
                </div>
              
                <div class="sidebar-nav-item">
                  10. <a class="sidebar-lesson " href="/de/lessons/basics/sigils/">Sigils</a>
                </div>
              
                <div class="sidebar-nav-item">
                  11. <a class="sidebar-lesson " href="/de/lessons/basics/documentation/">Dokumentation</a>
                </div>
              
                <div class="sidebar-nav-item">
                  12. <a class="sidebar-lesson  active" href="/de/lessons/basics/testing/">Testen</a>
                </div>
              
                <div class="sidebar-nav-item">
                  13. <a class="sidebar-lesson " href="/de/lessons/basics/comprehensions/">Comprehensions</a>
                </div>
              
                <div class="sidebar-nav-item">
                  14. <a class="sidebar-lesson " href="/de/lessons/basics/strings/">Strings</a>
                </div>
              
                <div class="sidebar-nav-item">
                  15. <a class="sidebar-lesson " href="/de/lessons/basics/mix-tasks/">Custom Mix Tasks</a>
                </div>
              
            </div>
          </div>
        
      
        
        
        
        
          <div class="sidebar-nav-group advanced">
            <div class="sidebar-nav-header">
              <i class="fa  fa-chevron-right "></i>
              <span>Erweitert</span>
            </div>
            <div class="sidebar-nav-list"  style="display: none;" >
              
                <div class="sidebar-nav-item">
                  1. <a class="sidebar-lesson " href="/de/lessons/advanced/erlang/">Erlang-Interoperabilität</a>
                </div>
              
                <div class="sidebar-nav-item">
                  2. <a class="sidebar-lesson " href="/de/lessons/advanced/error-handling/">Fehlerbehandlung</a>
                </div>
              
                <div class="sidebar-nav-item">
                  3. <a class="sidebar-lesson " href="/de/lessons/advanced/escripts/">Ausführbare Dateien</a>
                </div>
              
                <div class="sidebar-nav-item">
                  4. <a class="sidebar-lesson " href="/de/lessons/advanced/concurrency/">Nebenläufigkeit</a>
                </div>
              
                <div class="sidebar-nav-item">
                  5. <a class="sidebar-lesson " href="/de/lessons/advanced/otp-concurrency/">OTP Nebenläufigkeit</a>
                </div>
              
                <div class="sidebar-nav-item">
                  6. <a class="sidebar-lesson " href="/de/lessons/advanced/otp-supervisors/">OTP Supervisors</a>
                </div>
              
                <div class="sidebar-nav-item">
                  7. <a class="sidebar-lesson " href="/de/lessons/advanced/metaprogramming/">Metaprogrammierung</a>
                </div>
              
                <div class="sidebar-nav-item">
                  8. <a class="sidebar-lesson " href="/de/lessons/advanced/umbrella-projects/">Umbrella-Projekte</a>
                </div>
              
                <div class="sidebar-nav-item">
                  9. <a class="sidebar-lesson " href="/de/lessons/advanced/typespec/">Spezifikationen und Typen</a>
                </div>
              
            </div>
          </div>
        
      
        
        
        
        
          <div class="sidebar-nav-group specifics">
            <div class="sidebar-nav-header">
              <i class="fa  fa-chevron-right "></i>
              <span>Einzelheiten</span>
            </div>
            <div class="sidebar-nav-list"  style="display: none;" >
              
                <div class="sidebar-nav-item">
                  3. <a class="sidebar-lesson " href="/de/lessons/specifics/eex/">Embedded Elixir (EEx)</a>
                </div>
              
            </div>
          </div>
        
      
        
        
        
        
      
    </nav>

    <p>
      

      
        <a href=" /lessons/basics/testing/ ">en</a>
      
        <a href=" /jp/lessons/basics/testing/ ">jp</a>
      
        <a href=" /cn/lessons/basics/testing/ ">cn</a>
      
        <a href=" /es/lessons/basics/testing/ ">es</a>
      
        <a href=" /pt/lessons/basics/testing/ ">pt</a>
      
        <a href=" /vi/lessons/basics/testing/ ">vi</a>
      
        <a href=" /ru/lessons/basics/testing/ ">ru</a>
      
        <a href=" /sk/lessons/basics/testing/ ">sk</a>
      
        <a href=" /fr/lessons/basics/testing/ ">fr</a>
      
        <a href=" /gr/lessons/basics/testing/ ">gr</a>
      
        <a href=" /it/lessons/basics/testing/ ">it</a>
      
        <a href=" /pl/lessons/basics/testing/ ">pl</a>
      
        <a href=" /my/lessons/basics/testing/ ">my</a>
      
        <a href=" /no/lessons/basics/testing/ ">no</a>
      
        <a href=" /ko/lessons/basics/testing/ ">ko</a>
      
        <a href=" /id/lessons/basics/testing/ ">id</a>
      
        <a href=" /uk/lessons/basics/testing/ ">uk</a>
      
        <a href=" /tr/lessons/basics/testing/ ">tr</a>
      
        <a href=" /bg/lessons/basics/testing/ ">bg</a>
      
        <a href=" /de/lessons/basics/testing/ ">de</a>
      
        <a href=" /bn/lessons/basics/testing/ ">bn</a>
      
    </p>

    <p>&copy; 2017 <a href="https://github.com/doomspork">Sean Callan</a></p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">Testen</h1>
  <p>Testen ist ein wichtiger Teil der Softwareentwicklung. In dieser Lektion werden wir uns anschauen, wie man Elixir Code mit ExUnit testet und einige best practices davon kennen lernen.</p>

<h2>Inhaltsverzeichnis</h2>
<div id="toc"></div>

<h2 id="exunit">ExUnit</h2>

<p>Elixirs eingebautes Testframework ist ExUnit und es beinhaltet alles, was wir brauchen, um unseren Code durch und durch zu testen. Bevor wir fortfahren, ist es wichtig festzuhalten, dass Tests als Elixirscripts implementiert werden, also müssen wir die <code class="highlighter-rouge">.exs</code>-Dateiendung verwenden. Bevor wir Tests laufen lassen können, müssen wir ExUnit startet mit den Aufruf <code class="highlighter-rouge">ExUnit.start()</code>, was meist in <code class="highlighter-rouge">test/test_helper.exs</code> geschieht.</p>

<p>Wenn wir unser Beispielprojekt in der letzten Lektion erstellt haben, hat mix bereits einfache Tests für uns generiert, die wir in <code class="highlighter-rouge">test/example_test.exs</code> finden:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">ExampleTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>
  <span class="n">doctest</span> <span class="no">Example</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">the truth"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="m">1</span> <span class="o">+</span> <span class="m">1</span> <span class="o">==</span> <span class="m">2</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Wir können die Tests unserer Projekts mit <code class="highlighter-rouge">mix test</code> starten. Falls wir das jetzt tun, sehen wir eine Ausgabe wie hier:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Finished <span class="k">in </span>0.03 seconds <span class="o">(</span>0.02s on load, 0.01s on tests<span class="o">)</span>
1 tests, 0 failures
</code></pre>
</div>

<h3 id="assert">assert</h3>

<p>Falls du schon mal Tests geschrieben hast, bist du vertraut mit <code class="highlighter-rouge">assert</code>; in manchen Frameworks übernehmen <code class="highlighter-rouge">should</code> oder <code class="highlighter-rouge">expect</code> die Rolle von <code class="highlighter-rouge">assert</code>.</p>

<p>Wir benutzen das <code class="highlighter-rouge">assert</code>-Makro, um zu überprüfen, ob ein Ausdruck wahr ist. Im Falle, dass dem nicht so ist, wird ein Fehler geworfen und unser Test schlägt fehl. Um einen Fehler zu testen, lass uns unser Beispiel verändern und dann <code class="highlighter-rouge">mix test</code> aufrufen:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">ExampleTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>
  <span class="n">doctest</span> <span class="no">Example</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">the truth"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="m">1</span> <span class="o">+</span> <span class="m">1</span> <span class="o">==</span> <span class="m">3</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Dann sollten wir eine Ausgabe ähnlich wie hier sehen:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  1<span class="o">)</span> <span class="nb">test </span>the truth <span class="o">(</span>ExampleTest<span class="o">)</span>
     <span class="nb">test</span>/example_test.exs:5
     Assertion with <span class="o">==</span> failed
     code: 1 + 1 <span class="o">==</span> 3
     lhs:  2
     rhs:  3
     stacktrace:
       <span class="nb">test</span>/example_test.exs:6

......

Finished <span class="k">in </span>0.03 seconds <span class="o">(</span>0.02s on load, 0.01s on tests<span class="o">)</span>
1 tests, 1 failures
</code></pre>
</div>

<p>ExUnit sagt uns exakt, wo unsere fehlgeschlagene Annahme ist, was der erwartete Wert ist und was der tatsächliche Wert war.</p>

<h3 id="refute">refute</h3>

<p><code class="highlighter-rouge">refute</code> ist zu <code class="highlighter-rouge">assert</code> das, was <code class="highlighter-rouge">unless</code> zu <code class="highlighter-rouge">if</code> ist. Benutze <code class="highlighter-rouge">refute</code> wenn du sicher stellen willst, dass ein Ausdruck immer falsch ist.</p>

<h3 id="assertraise">assert_raise</h3>

<p>Manchmal kann es notwendig sein sicherzustellen, dass ein Fehler geworfen wurde. Wir können das mit <code class="highlighter-rouge">assert_raise</code> machen.  Wir werden ein Beispiel von <code class="highlighter-rouge">assert_raise</code> in der nächsten Lektion zu Plug sehen.</p>

<h3 id="assertreceive">assert_receive</h3>

<p>In Elixir bestehen Anwendungen aus Actors/Prozessen, die sich gegenseitig Nachrichten schicken können. Daher möchtest du oft testen, ob eine Nachricht versendet wurde. Da ExUnit in seinem eigenen Prozess läuft, kann es wie jeder andere Prozess Nachrichten empfangen und du kannst mit dem <code class="highlighter-rouge">assert_received</code>-Makro asserten:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">SendingProcess</span> <span class="k">do</span>
  <span class="k">def</span> <span class="n">run</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">send</span> <span class="n">pid</span><span class="p">,</span> <span class="ss">:ping</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">defmodule</span> <span class="no">TestReceive</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">receives ping"</span> <span class="k">do</span>
    <span class="no">SendingProcess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="n">assert_received</span> <span class="ss">:ping</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">assert_received</code> wartet nicht auf Nachrichten, mit <code class="highlighter-rouge">assert_receive</code> kannst du einen Timeout festlegen.</p>

<h2 id="captureio-und-capturelog">capture_io und capture_log</h2>

<p>Die Ausgabe einer Anwendung aufzuzeichen ist mit <code class="highlighter-rouge">ExUnit.captureIO</code> möglich, ohne die Originalanwendung umzuschreiben. Gib ihr einfach nur die Funktion, die die Ausgabe generiert:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">OutputTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>
  <span class="kn">import</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">CaptureIO</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">outputs Hello World"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="n">capture_io</span><span class="p">(</span><span class="k">fn</span> <span class="o">-&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="sd">"</span><span class="s2">Hello World"</span> <span class="k">end</span><span class="p">)</span> <span class="o">==</span> <span class="sd">"</span><span class="s2">Hello World\n"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">ExUnit.CaptureLog</code> ist das Äquivalent zu <code class="highlighter-rouge">Logger</code>, um Ausgaben aufzuzeichen.</p>

<h2 id="test-setup">Test Setup</h2>

<p>Manchmal kann es notwendig sein, ein paar Setups auszuführen, bevor Tests laufen können. Um das zu bewerkstelligen können wir die <code class="highlighter-rouge">setup</code>- und <code class="highlighter-rouge">setup_all</code>-Makros nutzen. <code class="highlighter-rouge">setup</code> wird vor jedem Test aufgerufen und <code class="highlighter-rouge">setup_all</code> einmal vor der Testsuite. Es wird davon ausgegangen, dass sie ein Tupel mit <code class="highlighter-rouge"><span class="p">{</span><span class="err">:ok,</span><span class="w"> </span><span class="err">state</span><span class="p">}</span></code> zurückgeben, der Zustand wird für unsere Tests verfügbar sein.</p>

<p>Deutlichkeitshalber werden wir unseren Code so ändern, dass er <code class="highlighter-rouge">setup_all</code> nutzt:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">ExampleTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">ExUnit</span><span class="o">.</span><span class="no">Case</span>
  <span class="n">doctest</span> <span class="no">Example</span>

  <span class="n">setup_all</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="ss">number:</span> <span class="m">2</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="n">test</span> <span class="sd">"</span><span class="s2">the truth"</span><span class="p">,</span> <span class="n">state</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="m">1</span> <span class="o">+</span> <span class="m">1</span> <span class="o">==</span> <span class="n">state</span><span class="p">[</span><span class="ss">:number</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<h2 id="mocking">Mocking</h2>

<p>Die einfache Antwort für mocking in Elixir ist: Tu es nicht. Du magst vielleicht instinktiv mocks nehmen wollen, aber sie werden aus gutem Grund von der Elixir-Community nicht benutzt.</p>

<p>Für eine längere Diskussion ist hier ein <a href="http://blog.plataformatec.com.br/2015/10/mocks-and-explicit-contracts/">exzellenter Artikel</a>. Die Zusammenfassung ist, dass statt dem mocken (mock als <em>Verb</em>) von Testen von Abhängigkeiten es mehr Vorteile hat, Schnittstellen für Code außerhalb deines Codes explizit zu definieren (Verhaltensweisen) und Mocks (als <em>Nomen</em>) in deinem Clientcode zum Testen dazu zu benutzen.</p>

<p>Um die Implementierung in deinem Anwendungscode zu wechseln ist der präferierte Weg ein Modul als Argument zu übergeben und einen Defaultwert zu verwenden. Falls das nicht funktioniert, benutze den eingebauten Konfigurationsmechanismus. Um dies Mock-Implementierungen zu erstellen brauchst du keine spezielle Mocking-Bibliothek, sondern einfach nur behaviours und callbacks.</p>


  

<hr />
<h3 id="social">
  
    Share This Page
  
</h3>
<div class="social__container">
  <div class="social__item">
    <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://elixirschool.com/de/lessons/basics/testing/&title=Testen&summary=description&source=https://elixirschool.com" class="social__icon--linkedin"><i class="icon--linkedin"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://twitter.com/intent/tweet?url=https://elixirschool.com/de/lessons/basics/testing/&via=elixirschool&text=ElixirSchool: Testen&hashtags=learnelixir%2Celixirlang&" class="social__icon--twitter"><i class="icon--twitter"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://plus.google.com/share?url=https://elixirschool.com/de/lessons/basics/testing/" class="social__icon--googleplus"><i class="icon--googleplus"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://elixirschool.com/de/lessons/basics/testing/" class="social__icon--facebook"><i class="icon--facebook"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://www.pinterest.com/pin/create/link/?url=https://elixirschool.com/de/lessons/basics/testing/&media=https://elixirschool.com/assets/fb_share.jpg&description=ElixirSchool: Testen" class="social__icon--pinterest"><i class="icon--pinterest"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://www.evernote.com/noteit.action?url=https://elixirschool.com/de/lessons/basics/testing/&title=ElixirSchool: Testen&suggestTags=elixir,programming" class="social__icon--evernote"><i class="icon--evernote"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://vk.com/share.php?url=https://elixirschool.com/de/lessons/basics/testing/&title=ElixirSchool: Testen&description=Check out 'Testen' on ElixirSchool" class="social__icon--vk" style="margin-left: 2px;"><i class="icon--vk"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="mailto:?&subject=ElixirSchool: Testen&body=Check out 'Testen' on ElixirSchool%0D%0A%0D%0Ahttps://elixirschool.com/de/lessons/basics/testing/" class="social__icon--email"><i class="icon--email"></i></a>
  </div>
  <div class="social__item">
    <a href="javascript:window.print()" class="social__icon--print"><i class="icon--print"></i></a>
  </div>
</div>
</div>
    </div>
  <script type="text/javascript" src="/assets/app.js"></script>
  </body>
</html>
