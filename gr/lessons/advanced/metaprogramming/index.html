<!DOCTYPE html>

<html lang="en-us">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link href="http://gmpg.org/xfn/11" rel="profile">

  <meta name="description" content="Μαθήματα προγραμματισμού της γλώσσας Elixir">
  <meta name="author" content="Sean Callan">

  <meta property="og:url" content="https://elixirschool.com/gr/lessons/advanced/metaprogramming/">
  <meta property="og:site_name" content="ElixirSchool">
  <meta property="og:title" content="
  Μεταπρογραμματισμός &middot; Elixir School

">
  <meta property="og:description" content="Μαθήματα προγραμματισμού της γλώσσας Elixir">
  <meta property="og:image" content="https://elixirschool.com/assets/fb_share.jpg">

  <title>
    
  Μεταπρογραμματισμός &middot; Elixir School


  </title>

  <!-- CSS -->
  <link type="text/css" rel="stylesheet" href="/assets/app.css">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
  analytics.load("C0p07Sw9j7mZnycKDCgPOAyqJR5hhyoQ");
  analytics.page()
  }}();
  </script>

</head>


  
  <body class="theme-custom-purple ">
    <a id="github_ribbon" href="https://github.com/doomspork/elixir_school"><img src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>

    
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Elixir School
        </a>
      </h1>
      <p class="lead">Μαθήματα προγραμματισμού της γλώσσας Elixir</p>
    </div>

    <nav class="sidebar-nav">
      
      
        
        
        
        
          <div class="sidebar-nav-group basics">
            <div class="sidebar-nav-header">
              <i class="fa  fa-chevron-right "></i>
              <span>Βασικά</span>
            </div>
            <div class="sidebar-nav-list"  style="display: none;" >
              
                <div class="sidebar-nav-item">
                  1. <a class="sidebar-lesson " href="/gr/lessons/basics/basics/">Βασικά</a>
                </div>
              
                <div class="sidebar-nav-item">
                  2. <a class="sidebar-lesson " href="/gr/lessons/basics/collections/">Συλλογές</a>
                </div>
              
                <div class="sidebar-nav-item">
                  3. <a class="sidebar-lesson " href="/gr/lessons/basics/enum/">Enum</a>
                </div>
              
                <div class="sidebar-nav-item">
                  4. <a class="sidebar-lesson " href="/gr/lessons/basics/pattern-matching/">Αντιπαραβολές Προτύπων</a>
                </div>
              
                <div class="sidebar-nav-item">
                  5. <a class="sidebar-lesson " href="/gr/lessons/basics/control-structures/">Δομές Ελέγχου</a>
                </div>
              
                <div class="sidebar-nav-item">
                  6. <a class="sidebar-lesson " href="/gr/lessons/basics/functions/">Συναρτήσεις</a>
                </div>
              
                <div class="sidebar-nav-item">
                  7. <a class="sidebar-lesson " href="/gr/lessons/basics/pipe-operator/">Τελεστής Σωλήνα</a>
                </div>
              
                <div class="sidebar-nav-item">
                  8. <a class="sidebar-lesson " href="/gr/lessons/basics/modules/">Ενότητες</a>
                </div>
              
                <div class="sidebar-nav-item">
                  9. <a class="sidebar-lesson " href="/gr/lessons/basics/mix/">Mix</a>
                </div>
              
                <div class="sidebar-nav-item">
                  10. <a class="sidebar-lesson " href="/gr/lessons/basics/sigils/">Σφραγίδες</a>
                </div>
              
                <div class="sidebar-nav-item">
                  11. <a class="sidebar-lesson " href="/gr/lessons/basics/documentation/">Τεκμηρίωση</a>
                </div>
              
                <div class="sidebar-nav-item">
                  12. <a class="sidebar-lesson " href="/gr/lessons/basics/testing/">Δοκιμές</a>
                </div>
              
                <div class="sidebar-nav-item">
                  13. <a class="sidebar-lesson " href="/gr/lessons/basics/comprehensions/">Ανάγνωση Λιστών</a>
                </div>
              
                <div class="sidebar-nav-item">
                  14. <a class="sidebar-lesson " href="/gr/lessons/basics/strings/">Αλφαριθμητικά</a>
                </div>
              
                <div class="sidebar-nav-item">
                  15. <a class="sidebar-lesson " href="/gr/lessons/basics/mix-tasks/">Ειδικές Εργασίες Mix</a>
                </div>
              
            </div>
          </div>
        
      
        
        
        
        
          <div class="sidebar-nav-group advanced">
            <div class="sidebar-nav-header">
              <i class="fa  fa-chevron-down "></i>
              <span>Προχωρημένα</span>
            </div>
            <div class="sidebar-nav-list" >
              
                <div class="sidebar-nav-item">
                  1. <a class="sidebar-lesson " href="/gr/lessons/advanced/erlang/">Διαλειτουργικότητα με την Erlang</a>
                </div>
              
                <div class="sidebar-nav-item">
                  2. <a class="sidebar-lesson " href="/gr/lessons/advanced/error-handling/">Διαχείριση Σφαλμάτων</a>
                </div>
              
                <div class="sidebar-nav-item">
                  3. <a class="sidebar-lesson " href="/gr/lessons/advanced/escripts/">Εκτελέσιμα</a>
                </div>
              
                <div class="sidebar-nav-item">
                  4. <a class="sidebar-lesson " href="/gr/lessons/advanced/concurrency/">Συγχρονισμός</a>
                </div>
              
                <div class="sidebar-nav-item">
                  5. <a class="sidebar-lesson " href="/gr/lessons/advanced/otp-concurrency/">Συγχρονισμός OTP</a>
                </div>
              
                <div class="sidebar-nav-item">
                  6. <a class="sidebar-lesson " href="/gr/lessons/advanced/otp-supervisors/">Επιτηρητές OTP</a>
                </div>
              
                <div class="sidebar-nav-item">
                  7. <a class="sidebar-lesson  active" href="/gr/lessons/advanced/metaprogramming/">Μεταπρογραμματισμός</a>
                </div>
              
                <div class="sidebar-nav-item">
                  8. <a class="sidebar-lesson " href="/gr/lessons/advanced/umbrella-projects/">Projects Ομπρέλας</a>
                </div>
              
                <div class="sidebar-nav-item">
                  9. <a class="sidebar-lesson " href="/gr/lessons/advanced/typespec/">Προδιαγραφές και τύποι</a>
                </div>
              
                <div class="sidebar-nav-item">
                  10. <a class="sidebar-lesson " href="/gr/lessons/advanced/behaviours/">Συμπεριφορές</a>
                </div>
              
                <div class="sidebar-nav-item">
                  11. <a class="sidebar-lesson " href="/gr/lessons/advanced/gen-stage/">GenStage</a>
                </div>
              
            </div>
          </div>
        
      
        
        
        
        
          <div class="sidebar-nav-group specifics">
            <div class="sidebar-nav-header">
              <i class="fa  fa-chevron-right "></i>
              <span>Ιδιαιτερότητες</span>
            </div>
            <div class="sidebar-nav-list"  style="display: none;" >
              
                <div class="sidebar-nav-item">
                  1. <a class="sidebar-lesson " href="/gr/lessons/specifics/plug/">Plug</a>
                </div>
              
                <div class="sidebar-nav-item">
                  2. <a class="sidebar-lesson " href="/gr/lessons/specifics/ecto/">Ecto</a>
                </div>
              
                <div class="sidebar-nav-item">
                  3. <a class="sidebar-lesson " href="/gr/lessons/specifics/eex/">Ένθετη Elixir (EEx)</a>
                </div>
              
                <div class="sidebar-nav-item">
                  4. <a class="sidebar-lesson " href="/gr/lessons/specifics/ets/">Erlang Term Storage (ETS)</a>
                </div>
              
                <div class="sidebar-nav-item">
                  5. <a class="sidebar-lesson " href="/gr/lessons/specifics/mnesia/">Mnesia</a>
                </div>
              
            </div>
          </div>
        
      
        
        
        
        
          <div class="sidebar-nav-group libraries">
            <div class="sidebar-nav-header">
              <i class="fa  fa-chevron-right "></i>
              <span>Βιβλιοθήκες</span>
            </div>
            <div class="sidebar-nav-list"  style="display: none;" >
              
                <div class="sidebar-nav-item">
                  1. <a class="sidebar-lesson " href="/gr/lessons/libraries/guardian/">Guardian (Βασικά)</a>
                </div>
              
                <div class="sidebar-nav-item">
                  2. <a class="sidebar-lesson " href="/gr/lessons/libraries/poolboy/">Poolboy</a>
                </div>
              
            </div>
          </div>
        
      
    </nav>

    <p>
      

      
        <a href=" /lessons/advanced/metaprogramming/ ">en</a>
      
        <a href=" /jp/lessons/advanced/metaprogramming/ ">jp</a>
      
        <a href=" /cn/lessons/advanced/metaprogramming/ ">cn</a>
      
        <a href=" /es/lessons/advanced/metaprogramming/ ">es</a>
      
        <a href=" /pt/lessons/advanced/metaprogramming/ ">pt</a>
      
        <a href=" /vi/lessons/advanced/metaprogramming/ ">vi</a>
      
        <a href=" /ru/lessons/advanced/metaprogramming/ ">ru</a>
      
        <a href=" /sk/lessons/advanced/metaprogramming/ ">sk</a>
      
        <a href=" /fr/lessons/advanced/metaprogramming/ ">fr</a>
      
        <a href=" /gr/lessons/advanced/metaprogramming/ ">gr</a>
      
        <a href=" /it/lessons/advanced/metaprogramming/ ">it</a>
      
        <a href=" /pl/lessons/advanced/metaprogramming/ ">pl</a>
      
        <a href=" /my/lessons/advanced/metaprogramming/ ">my</a>
      
        <a href=" /no/lessons/advanced/metaprogramming/ ">no</a>
      
        <a href=" /ko/lessons/advanced/metaprogramming/ ">ko</a>
      
        <a href=" /id/lessons/advanced/metaprogramming/ ">id</a>
      
        <a href=" /uk/lessons/advanced/metaprogramming/ ">uk</a>
      
        <a href=" /tr/lessons/advanced/metaprogramming/ ">tr</a>
      
        <a href=" /bg/lessons/advanced/metaprogramming/ ">bg</a>
      
        <a href=" /de/lessons/advanced/metaprogramming/ ">de</a>
      
        <a href=" /bn/lessons/advanced/metaprogramming/ ">bn</a>
      
    </p>

    <p>&copy; 2017 <a href="https://github.com/doomspork">Sean Callan</a></p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">Μεταπρογραμματισμός</h1>
  <p>Ο Μεταπρογραμματισμός είναι η διαδικασία της χρήσης κώδικα που γράφει κώδικα.  Στην Elixir αυτό μας δίνει τη δυνατότητα να επεκτείνουμε τη γλώσσα ώστε να καλύπτει τις ανάγκες μας και να αλλάζει τον κώδικά μας δυναμικά.  Θα ξεκινήσουμε βλέποντας πως η Elixir παρουσιάζεται κάτω από το καπώ, πως να την αλλάξουμε, και τέλος πως να χρησιμοποιήσουμε αυτή τη γνώση για να την επεκτείνουμε.</p>

<p>Προειδοποίηση: ο Μεταπρογραμματισμός είναι δύσκολος και θα πρέπει να χρησιμοποιείται μόνο όταν είναι απολύτως απαραίτητος.  Η υπερβολική χρήση είναι σχεδόν σίγουρο ότι θα οδηγήσει σε περίπλοκο κώδικα που θα είναι δύσκολο να καταλάβουμε και διορθώσουμε.</p>

<h2>Πίνακας περιεχομένων</h2>
<div id="toc"></div>

<h2 id="quote">Παράθεση (Quote)</h2>

<p>Το πρώτο βήμα στο μεταπρογραμματισμό είναι η κατανόηση του πως παρουσιάζονται οι εκφράσεις.  Στην Elixir, το αφηρημένο συντακτικό δέντρο (abstract syntax tree - AST), η εσωτερική παρουσίαση του κώδικά μας, απαρτίζεται από τούπλες.  Αυτές οι τούπλες περιέχουν τρία μέρη: το όνομα της συνάρτησης, τα μεταδεδομένα, και τα ορίσματα της συνάρτησης.</p>

<p>Για να δούμε αυτές τις εσωτερικές δομές, η Elixir μας παρέχει τη συνάρτηση της <code class="highlighter-rouge">quote/2</code>.  Με τη χρήση της <code class="highlighter-rouge">quote/2</code> μπορούμε να μετατρέψουμε τον κώδικα Elixir στη βασική του παρουσίαση:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="m">42</span>
<span class="m">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="sd">"</span><span class="s2">Γειά"</span>
<span class="sd">"</span><span class="s2">Γειά"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="ss">:world</span>
<span class="ss">:world</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="m">1</span> <span class="o">+</span> <span class="m">2</span>
<span class="p">{</span><span class="ss">:+</span><span class="p">,</span> <span class="p">[</span><span class="ss">context:</span> <span class="no">Elixir</span><span class="p">,</span> <span class="kn">import</span><span class="p">:</span> <span class="no">Kernel</span><span class="p">],</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">]}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="k">if</span> <span class="n">value</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="sd">"</span><span class="s2">Αλήθεια"</span><span class="p">,</span> <span class="k">else</span><span class="p">:</span> <span class="sd">"</span><span class="s2">Ψέματα"</span>
<span class="p">{</span><span class="ss">:if</span><span class="p">,</span> <span class="p">[</span><span class="ss">context:</span> <span class="no">Elixir</span><span class="p">,</span> <span class="kn">import</span><span class="p">:</span> <span class="no">Kernel</span><span class="p">],</span>
 <span class="p">[{</span><span class="ss">:value</span><span class="p">,</span> <span class="p">[],</span> <span class="no">Elixir</span><span class="p">},</span> <span class="p">[</span><span class="k">do</span><span class="p">:</span> <span class="sd">"</span><span class="s2">Αλήθεια"</span><span class="p">,</span> <span class="k">else</span><span class="p">:</span> <span class="sd">"</span><span class="s2">Ψέματα"</span><span class="p">]]}</span>
</code></pre>
</div>

<p>Παρατηρείτε πως τα πρώτα τρία δεν επιστρέφουν τούπλες;  Υπάρχουν πέντε κυριολεκτικά που επιστρέφουν τον εαυτό τους όταν παρατίθενται:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:atom</span>
<span class="ss">:atom</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="sd">"</span><span class="s2">string"</span>
<span class="sd">"</span><span class="s2">string"</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="m">1</span> <span class="c1"># Όλοι οι αριθμοί</span>
<span class="m">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">]</span> <span class="c1"># Λίστες</span>
<span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">]</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="p">{</span><span class="sd">"</span><span class="s2">hello"</span><span class="p">,</span> <span class="ss">:world</span><span class="p">}</span> <span class="c1"># τούπλες 2 στοιχείων</span>
<span class="p">{</span><span class="sd">"</span><span class="s2">hello"</span><span class="p">,</span> <span class="ss">:world</span><span class="p">}</span>
</code></pre>
</div>

<h2 id="unquote">Αποπαράθεση (Unquote)</h2>

<p>Τώρα που μπορούμε να πάρουμε την εσωτερική δομή του κώδικά μας, πως την μετατρέπουμε;  Για να εισάγουμε νέο κώδικα ή τιμές χρησιμοποιούμε την <code class="highlighter-rouge">unquote/1</code>.  Όταν αποπαρατίθεται μια έκφραση, αυτή θα εκτιμηθεί και εισηχθεί στο AST.  Για να επιδείξουμε την <code class="highlighter-rouge">unquote/1</code>, ας δούμε μερικά παραδείγματα:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">denominator</span> <span class="o">=</span> <span class="m">2</span>
<span class="m">2</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">divide</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
<span class="p">{</span><span class="ss">:divide</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="m">42</span><span class="p">,</span> <span class="p">{</span><span class="ss">:denominator</span><span class="p">,</span> <span class="p">[],</span> <span class="no">Elixir</span><span class="p">}]}</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">divide</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">denominator</span><span class="p">))</span>
<span class="p">{</span><span class="ss">:divide</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="m">42</span><span class="p">,</span> <span class="m">2</span><span class="p">]}</span>
</code></pre>
</div>

<p>Στο πρώτο παράδειγμα, η μεταβλητή <code class="highlighter-rouge">denominator</code> παρατίθεται και έτσι το παραγόμενο AST περιλαμβάνει μια τούπλα για την πρόσβαση στη μεταβλητή.  Αντίθετα, στο παράδειγμα της <code class="highlighter-rouge">unquote/1</code>, ο παραγόμενος κώδικας περιλαμβάνει την τιμή της <code class="highlighter-rouge">denominator</code>.</p>

<h2 id="section">Μακροεντολές</h2>

<p>Όταν κατανοήσουμε τις <code class="highlighter-rouge">quote/2</code> και <code class="highlighter-rouge">unquote/1</code>, είμαστε έτοιμοι να ασχοληθούμε με τις μακροεντολές.  Είναι σημαντικό να θυμόμαστε ότι οι μακροεντολές, όπως ο μεταπρογραμματισμός, πρέπει να χρησιμοποιούνται με οικονομία.</p>

<p>Εν συντομία, οι μακροεντολές είναι ειδικές συναρτήσεις σχεδιασμένες να επιστρέφουν μια παρατιθέμενη έκφραση που θα εισηχθεί στον κώδικα της εφαρμογής μας.  Φανταστείτε ότι η μακροεντολή αντικαθιστάται με την παρατιθέμενη έκφραση αντί να κληθεί σαν συνάρτηση.  Με τις μακροεντολές, έχουμε ότι είναι απαραίτητο για να επεκτείνουμε την Elixir και να προσθέσουμε δυναμικά κώδικα στις εφαρμογές μας.</p>

<p>Ξεκινάμε ορίζοντας μια μακροεντολή με τη χρήση της <code class="highlighter-rouge">defmacro/2</code>, η οποία, όπως πολλά στην Elixir, είναι και η ίδια μακροεντολή (κρατήστε το αυτό).  Σαν παράδειγμα θα υλοποιήσουμε την <code class="highlighter-rouge">unless</code> σαν μακροεντολή.  Θυμηθείτε ότι οι μακροεντολές μας πρέπει να επιστρέφουν μια παρατιθέμενη έκφραση:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">OurMacro</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="k">unless</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">block</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="k">if</span> <span class="n">!unquote</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Ας απαιτήσουμε την ενότητά μας και ας πάμε την μακροεντολή μια βόλτα:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">OurMacro</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">OurMacro</span><span class="o">.</span><span class="k">unless</span> <span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="sd">"</span><span class="s2">Hi"</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">OurMacro</span><span class="o">.</span><span class="k">unless</span> <span class="no">false</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="sd">"</span><span class="s2">Hi"</span>
<span class="sd">"</span><span class="s2">Hi"</span>
</code></pre>
</div>

<p>Επειδή οι μακροεντολές αντικαθιστούν κώδικα στην εφαρμογή μας, μπορούμε να χειριστούμε το πότε και το τι συντάσσεται.  Ένα παράδειγμα αυτού μπορεί να βρεθεί στην ενότητα <code class="highlighter-rouge">Logger</code>.  Όταν η καταγραφή είναι απενεργοποιημένη δεν εισάγεται κώδικας και η παραγόμενη εφαρμογή δεν περιέχει αναφορές ή κλήσεις συναρτήσεων καταγραφής.  Αυτό είναι διαφορετικό από άλλες γλώσσες όπου υπάρχει ακόμα το βάρος μιας κλήσης συνάρτησης ακόμα και όταν η υλοποίηση δεν τη χρησιμοποιεί.</p>

<p>Για να κάνουμε μια επίδειξη αυτού, θα δημιουργήσουμε έναν απλό καταγραφέα ο οποίος μπορεί είτε να ενεργοποιηθεί ή να απενεργοποιηθεί:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Logger</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">if</span> <span class="no">Application</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="ss">:logger</span><span class="p">,</span> <span class="ss">:enabled</span><span class="p">)</span> <span class="k">do</span>
      <span class="kn">quote</span> <span class="k">do</span>
        <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="sd">"</span><span class="s2">Καταγεγραμμένο Μήνυμα: </span><span class="si">#{</span><span class="kn">unquote</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="kn">require</span> <span class="no">Logger</span>

  <span class="k">def</span> <span class="n">test</span> <span class="k">do</span>
    <span class="no">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sd">"</span><span class="s2">Αυτό είναι ένα μήνυμα καταγραφής!"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Με την καταγραφή ενεργοποιημένη, η συνάρτησή <code class="highlighter-rouge">test</code> θα παράγει κώδικα που θα δείχνει όπως παρακάτω:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">test</span> <span class="k">do</span>
  <span class="no">IO</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="sd">"</span><span class="s2">Καταγεγραμμένο Μήνυμα: </span><span class="si">#{</span><span class="sd">"</span><span class="s2">Αυτό είναι ένα μήνυμα καταγραφής"</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Αλλά αν απενεργοποιήσουμε την καταγραφή, ο παραγόμενος κώδικας θα είναι:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">test</span> <span class="k">do</span>
<span class="k">end</span>
</code></pre>
</div>

<h2 id="section-1">Απασφαλμάτωση</h2>

<p>Ωραία, τώρα ξέρουμε πως να χρησιμοποιήσουμε τις <code class="highlighter-rouge">quote/2</code>, <code class="highlighter-rouge">unquote/1</code> και πως να γράφουμε μακροεντολές.  Τι γίνεται όμως αν έχουμε ένα μεγάλο μέρος παραθετιμένου κώδικα και θέλουμε να τον κατανοήσουμε;  Σε αυτή την περίπτωση, μπορείτε να χρησιμοποιήσετε την <code class="highlighter-rouge">Macro.to_string/2</code>.  Ρίξτε μια ματιά στο παράδειγμα:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="kn">quote</span><span class="p">(</span><span class="k">do</span><span class="p">:</span> <span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)))</span>
<span class="sd">"</span><span class="s2">foo.bar(1, 2, 3)"</span>
</code></pre>
</div>

<p>Και όταν θέλετε να δείτε τον κώδικα που παράγεται από τις μακροεντολές μπορείτε να τις συνδυάσετε με τις <code class="highlighter-rouge">Macro.expand/2</code> και <code class="highlighter-rouge">Macro.expand_once/2</code>, οι οποίες αναπτύσσουν τις μακροεντολές στον δοσμένο παρατιθέμενο κώδικα.  Η πρώτη μπορεί να τον αναπτύξει πολλές φορές, ενώ η δεύτερη μόνο μία.  Για παράδειγμα, ας αλλάξουμε το παράδειγμα της <code class="highlighter-rouge">unless</code> από τον προηγούμενο τομέα:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">OurMacro</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="k">unless</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="n">block</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="k">if</span> <span class="n">!unquote</span><span class="p">(</span><span class="n">expr</span><span class="p">),</span> <span class="k">do</span><span class="p">:</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="kn">require</span> <span class="no">OurMacro</span>
<span class="n">quoted</span> <span class="o">=</span> <span class="kn">quote</span> <span class="k">do</span>
  <span class="no">OurMacro</span><span class="o">.</span><span class="k">unless</span> <span class="no">true</span><span class="p">,</span> <span class="k">do</span><span class="p">:</span> <span class="sd">"</span><span class="s2">Γειά"</span>
<span class="k">end</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>iex&gt; quoted |&gt; Macro.expand_once(__ENV__) |&gt; Macro.to_string |&gt; IO.puts
if(!true) do
  "Γειά"
end
</code></pre>
</div>

<p>Αλλά αν τρέξουμε τον ίδιο κώδικα με την <code class="highlighter-rouge">Macro.expand/2</code>, γίνεται ενδιαφέρον:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="n">quoted</span> <span class="o">|&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">__ENV__</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="no">Macro</span><span class="o">.</span><span class="n">to_string</span> <span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">puts</span>
<span class="k">case</span><span class="p">(</span><span class="n">!true</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">x</span> <span class="ow">when</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="no">false</span><span class="p">,</span> <span class="no">nil</span><span class="p">]</span> <span class="o">-&gt;</span>
    <span class="no">nil</span>
  <span class="n">_</span> <span class="o">-&gt;</span>
    <span class="sd">"</span><span class="s2">Γειά"</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Όπως θα θυμάστε, αναφέραμε ότι η <code class="highlighter-rouge">if</code> είναι μια μακροεντολή στην Elixir, εδώ μπορούμε να την δούμε αναπτυγμένη στην βασική της δήλωση <code class="highlighter-rouge">case</code>.</p>

<h3 id="section-2">Ιδιωτικές Μακροεντολές</h3>

<p>Παρόλο που δεν είναι συνηθισμένο, η Elixir υποστηρίζει ιδιωτικές μακροεντολές.  Μια ιδιωτική μακροεντολή ορίζεται με την <code class="highlighter-rouge">defmacrop</code> και μπορεί μόνο να κληθεί από την ενότητα στην οποία ορίζεται.  Οι ιδιωτικές μακροεντολές πρέπει να ορίζονται πριν από τον κώδικα που τις καλεί.</p>

<h3 id="section-3">Υγιεινή Μακροεντολών</h3>

<p>Ο τρόπος που αλληλεπιδρούν οι μακροεντολές με τα συμφραζόμενα αυτού που την καλεί όταν αναπτυχθεί, είναι γνωστός και ως υγιεινή μακροεντολών.  Οι μακροεντολές στην Elixir είναι υγιεινές από φυσικού τους και δεν θα συγκρουστούν με το περιβάλλον μας:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">hygienic</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="m">1</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">Example</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span> <span class="o">=</span> <span class="m">42</span>
<span class="m">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">hygienic</span>
<span class="o">-</span><span class="m">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span>
<span class="m">42</span>
</code></pre>
</div>

<p>Τι θα γινόταν όμως αν θέλαμε να χειριστούμε την τιμή της <code class="highlighter-rouge">val</code>;  Για να χαρακτηρίσουμε μια μεταβλητή ως ανθυγιεινή μπορούμε να χρησιμοποιήσουμε την <code class="highlighter-rouge">var!/2</code>.  Ας αναβαθμίσουμε το παράδειγμά μας με μια άλλη μακροεντολή που κάνει χρήση της <code class="highlighter-rouge">var!/2</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">hygienic</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="m">1</span>
  <span class="k">end</span>

  <span class="k">defmacro</span> <span class="n">unhygienic</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span><span class="p">:</span> <span class="n">var!</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="m">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Ας συγκρίνουμε τώρα πως αλληλεπιδρούν με το περιβάλλον μας:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">Example</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span> <span class="o">=</span> <span class="m">42</span>
<span class="m">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">hygienic</span>
<span class="o">-</span><span class="m">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span>
<span class="m">42</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">unhygienic</span>
<span class="o">-</span><span class="m">1</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="n">val</span>
<span class="o">-</span><span class="m">1</span>
</code></pre>
</div>

<p>Ενσωματώνοντας την <code class="highlighter-rouge">var!/2</code> στην μακροεντολή μας, χειριστήκαμε την τιμή της <code class="highlighter-rouge">val</code> χωρίς να την περάσουμε στη μακροεντολή.  Η χρήση των ανθυγιεινών μακροεντολών θα πρέπει να περιορίζεται.  Ενσωματώνοντας την <code class="highlighter-rouge">var!/2</code> αυξάνουμε το ρίσκο μιας σύγκρουσης μεταβλητών.</p>

<h3 id="section-4">Δέσιμο</h3>

<p>Καλύψαμε ήδη τη χρησιμότητα της <code class="highlighter-rouge">unquote/1</code>, αλλά πάρχει ένας άλλος τρόπος να εισάγουμε τιμές στον κώδικά μας: το δέσιμο.  Με το δέσιμο μεταβλητών είμαστε σε θέση να συμπεριλάβουμε πολλαπλές μεταβλητές στις μακροεντολές μας και να βεβαιωθούμε ότι αποπαρατίθενται μόνο μια φορά, αποφεύγοντας τις ατυχείς επανεκτιμήσεις.  Για να χρησιμοποιήσουμε δεμένες μεταβλητές θα πρέπει να περάσουμε μια λίστα λέξεων κλειδί στην επιλογή <code class="highlighter-rouge">bind_quoted</code> της <code class="highlighter-rouge">quote/2</code>.</p>

<p>Για να δούμε το όφελος της <code class="highlighter-rouge">bind_quote</code> και να επιδείξουμε το θέμα με την επανεκτίμηση ας χρησιμοποιήσουμε ένα παράδειγμα.  Μπορούμε να αρχίσουμε με τη δημιουργία μιας μακροεντολής που απλά παραθέτει την έκφραση δύο φορές:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">double_puts</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
      <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="kn">unquote</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>Θα δοκιμάσουμε τη νέα μας μακροεντολή περνώντας της την τρέχουσα ώρα συστήματος.  Θα πρέπει να δούμε την έξοδο δύο φορές:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">double_puts</span><span class="p">(</span><span class="ss">:os</span><span class="o">.</span><span class="n">system_time</span><span class="p">)</span>
<span class="m">1450475941851668000</span>
<span class="m">1450475941851733000</span>
</code></pre>
</div>

<p>Οι ώρες είναι διαφορετικές!  Τι συνέβη;  Η χρήση της <code class="highlighter-rouge">unquote/1</code> στην ίδια έκφραση πολλαπλές φορές έχει σαν αποτέλεσμα την επανεκτίμησή της και αυτό μπορεί να έχει απρόσκοπτες συνέπειες.  Ας αναβαθμίσουμε το παράδειγμα ώστε να χρησιμοποεί την <code class="highlighter-rouge">bind_quoted</code> και ας δούμε τι παίρνουμε:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
  <span class="k">defmacro</span> <span class="n">double_puts</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="ss">bind_quoted:</span> <span class="p">[</span><span class="ss">expr:</span> <span class="n">expr</span><span class="p">]</span> <span class="k">do</span>
      <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="n">expr</span>
      <span class="no">IO</span><span class="o">.</span><span class="n">puts</span> <span class="n">expr</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">iex</span><span class="o">&gt;</span> <span class="kn">require</span> <span class="no">Example</span>
<span class="no">nil</span>
<span class="n">iex</span><span class="o">&gt;</span> <span class="no">Example</span><span class="o">.</span><span class="n">double_puts</span><span class="p">(</span><span class="ss">:os</span><span class="o">.</span><span class="n">system_time</span><span class="p">)</span>
<span class="m">1450476083466500000</span>
<span class="m">1450476083466500000</span>
</code></pre>
</div>

<p>Με την <code class="highlighter-rouge">bind_quoted</code> παίρνουμε το προσδωκόμενο αποτέλεσμα: την ίδια ώρα εκτυπωμένη δις.</p>

<p>Τώρα που καλύψαμε τις <code class="highlighter-rouge">quote/2</code>, <code class="highlighter-rouge">unquote/1</code>, και την <code class="highlighter-rouge">defmacro/2</code> έχουμε όλα τα εργαλεία που είναι απαραίτητα για να επεκτείνουμε την Elixir ώστε να καλύπτει τις ανάγκες μας.</p>


  

<hr />
<h3 id="social">
  
    Share This Page
  
</h3>
<div class="social__container">
  <div class="social__item">
    <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://elixirschool.com/gr/lessons/advanced/metaprogramming/&title=Μεταπρογραμματισμός&summary=description&source=https://elixirschool.com" class="social__icon--linkedin"><i class="icon--linkedin"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://twitter.com/intent/tweet?url=https://elixirschool.com/gr/lessons/advanced/metaprogramming/&via=elixirschool&text=ElixirSchool: Μεταπρογραμματισμός&hashtags=learnelixir%2Celixirlang&" class="social__icon--twitter"><i class="icon--twitter"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://plus.google.com/share?url=https://elixirschool.com/gr/lessons/advanced/metaprogramming/" class="social__icon--googleplus"><i class="icon--googleplus"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://elixirschool.com/gr/lessons/advanced/metaprogramming/" class="social__icon--facebook"><i class="icon--facebook"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://www.pinterest.com/pin/create/link/?url=https://elixirschool.com/gr/lessons/advanced/metaprogramming/&media=https://elixirschool.com/assets/fb_share.jpg&description=ElixirSchool: Μεταπρογραμματισμός" class="social__icon--pinterest"><i class="icon--pinterest"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://www.evernote.com/noteit.action?url=https://elixirschool.com/gr/lessons/advanced/metaprogramming/&title=ElixirSchool: Μεταπρογραμματισμός&suggestTags=elixir,programming" class="social__icon--evernote"><i class="icon--evernote"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="https://vk.com/share.php?url=https://elixirschool.com/gr/lessons/advanced/metaprogramming/&title=ElixirSchool: Μεταπρογραμματισμός&description=Check out 'Μεταπρογραμματισμός' on ElixirSchool" class="social__icon--vk" style="margin-left: 2px;"><i class="icon--vk"></i></a>
  </div>
  <div class="social__item">
    <a target="_blank" href="mailto:?&subject=ElixirSchool: Μεταπρογραμματισμός&body=Check out 'Μεταπρογραμματισμός' on ElixirSchool%0D%0A%0D%0Ahttps://elixirschool.com/gr/lessons/advanced/metaprogramming/" class="social__icon--email"><i class="icon--email"></i></a>
  </div>
  <div class="social__item">
    <a href="javascript:window.print()" class="social__icon--print"><i class="icon--print"></i></a>
  </div>
</div>
</div>
    </div>
  <script type="text/javascript" src="/assets/app.js"></script>
  </body>
</html>
